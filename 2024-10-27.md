# Evidenziamo che il criterio di ottimalita e' una condizione necessaria non sufficiente
il [[Metodo del simplesso#Criterio sufficiente di ottimalità]] non e' necessario ma sufficiente.
Vediamo un caso in cui mostriamo che la condizione non e' necessaria.
## esempio
$$
\begin{align}
\text{min } -x_{1}-4x_{2}-5x_{3}+10x_{4}+10x_{5} \\
x_{1}+2x_{4}-x_{5}=1 \\
x_{2}+x_{3}-x_{4}+x_{5}=0 \\
x\geq 0
\end{align}
$$
Vediamo le matrici:
$$
A=\begin{pmatrix}
1 & 0 & 0 & 2 & -1 \\
0 & 1 & 1 & -1 & 1
\end{pmatrix}
$$
Notiamo subito che conviene prendere
$$
\begin{align}
B_{1}=\{ 1,2 \} \text{ e } N_{1}=\{ 3,4,5 \} \\
B_{2}=\{ 1,3 \} \text{ e } N_{2}=\{ 2,4,5 \}
\end{align}
$$
Per $B_{1}$ e $N_{1}$ calcoliamoci $\bar{x}_{B}$ e il vettore di costo ridotto $\hat{c}_{N}^T=c_{N}^T-c_{B}^TA_{B}^{-1}A_{N}$
$$
\bar{x}_{B}=A_{B}^{-1}b=\begin{pmatrix}
1 \\
0
\end{pmatrix}
$$
$$
\hat{c}_{N}^T = \begin{pmatrix}
-5 & 10 & 10
\end{pmatrix}-\begin{pmatrix}
-1 & 4
\end{pmatrix}\begin{pmatrix}
0 & 2 & -1 \\
1 & -1 & 1
\end{pmatrix}=\begin{pmatrix}
-1 & 8 & 13
\end{pmatrix}
$$
la prima componente e' negativa quindi non soddisfa il criterio di ottimalita' per la seguente SBA
$$
\bar{x}=\begin{pmatrix}
1 \\
0 \\
0 \\
0 \\
0
\end{pmatrix}
$$
Vediamo adesso per $B_{2}$ e $N_{2}$
$$
\bar{x}_{B}=A_{B}^{-1}b=\begin{pmatrix}
1 \\
0
\end{pmatrix}
$$
$$
\hat{c}_{N}^T=\begin{pmatrix}
-4 & 10 & 10
\end{pmatrix}-\begin{pmatrix}
-1 & -5
\end{pmatrix}\begin{pmatrix}
0 & 2 & -1 \\
1 & -1 & 1
\end{pmatrix}=\begin{pmatrix}
1 & 2 & 14
\end{pmatrix}
$$
Essendo tutte le componenti positive, il criterio di ottimalita' risulta soddisfatto per 
$$
\bar{x}=\begin{pmatrix}
1 \\
0 \\
0 \\
0 \\
0
\end{pmatrix}
$$
Notiamo che otteniamo la stessa SBA per entrambi i casi, solo che per il primo caso il criterio non "individua" il fatto che si tratti di una soluzione ottimale. Questo perché il criterio non e' sufficiente per SBA degeneri.

# Fase 2 operazione di pivot (simplesso)

L'operazione di pivot consiste nel passaggio da una SBA ad un'altra SBA non peggiore.
Prendiamo una SBA che non soddisfa ne il criterio di illimitatezza ne il criterio di ottimalita.
$$
\bar{x}=\begin{pmatrix}
A_{B}^{-1}b \\
0
\end{pmatrix}
$$
Significa che 
$$
\exists j\in N:\hat{c}_{j}<0 \quad \text{e }-A_{B}^{-1}A_{j}< 0
$$
adesso vogliamo generare una nuova SBA $\tilde{x}$ a parte da $\bar{x}$ tale che $\tilde{x}_{j}> 0$ e $\tilde{x}_{h}=0$ con $h\neq j,h\in N$.
$$
f(\bar{x})=c_{B}^TA_{B}^{-1}b
$$$$
f(\tilde{x})=c_{B}^TA_{B}^{-1}b+\hat{c}_{j}\tilde{x}_{j}<f(\bar{x})
$$
Muoviamoci da $\bar{x}$ per migliorare la funzione obiettivo.
$$
\tilde{x}=\bar{x}+\delta d=\begin{pmatrix}
\bar{x}_{B} \\
0_{N}
\end{pmatrix}+\delta \begin{pmatrix}
d_{B} \\
d_{N}
\end{pmatrix}=\bar{x}+\delta \begin{pmatrix}
y \\
0 \\
\vdots \\
1 \\
0 \\
\vdots \\
0
\end{pmatrix}\implies \tilde{x}_{j}=\delta
$$
Essendo che $\tilde{x}$ deve restare ammissibile significa che:
$$
\begin{align}
A\tilde{x}=b \\
\tilde{x}\geq 0
\end{align}
$$
Moltiplichiamo per A ambo i membri dell'equazione precedente
$$
A\tilde{x}=A\bar{x}+\delta(A_{B}d_{B}+A_{N}d_{N})=A\bar{x}+\delta(A_{B}y+A_{j})=b+\delta(A_{B}y+A_{j})
$$
adesso scelgo $y=-A_{B}^{-1}A_{j}$ in modo tale che $\tilde{x}$ risulti sempre ammissibile
$$
A\tilde{x}=b \quad\forall\delta
$$
## esempio
$$
B=\{ 5,3 \};N=\{ 2,4,1 \}
$$
$$
\begin{align}
A_{B}^{-1}b=\begin{pmatrix}
4 \\
2
\end{pmatrix} \\
\hat{c}_{N}^T=\begin{pmatrix}
-3 & 1 & 0
\end{pmatrix} \\
A_{B}^{-1}A_{N}=\begin{pmatrix}
2 & -4 & 1 \\
-1 & 2 & -1
\end{pmatrix}
\end{align}
$$
Abbiamo la seguente SBA
$$
\bar{x}=\begin{pmatrix}
0 \\
0 \\
2 \\
0 \\
4
\end{pmatrix}
$$
con 
$$
y=\begin{pmatrix}
-2 \\
1
\end{pmatrix}
$$
Notiamo che non e' verificato il criterio di ottimalita e neanche quello di illimitatezza.
Cerchiamo di migliorare la SBA
$$
\tilde{x}=\bar{x}+\delta d=\begin{pmatrix}
0 \\
0 \\
2 \\
0 \\
4
\end{pmatrix}+\delta \begin{pmatrix}
0 \\
1 \\
1 \\
0 \\
-2
\end{pmatrix}=\begin{pmatrix}
0 \\
\delta \\
2+\delta \\
0 \\
4-2\delta
\end{pmatrix} \geq 0
$$
Dove notiamo che abbiamo messo in $d$, nella posizione $3,5$ che fanno riferimento a $B$ i valori di $y$.

Vediamo che l'unica soluzione che ci introduce un vicolo e' l'ultima
$$
4-2\delta \geq 0 \implies \delta\leq 2
$$
quindi 
$$
f(\tilde{x})=f(\bar{x})+\hat{c}_{j}\delta=f(\bar{x})-3\delta=f(\bar{x})-6
$$
dove scegliendo $\delta = 2$ (il meglio che possiamo scegliere) abbiamo migliorato di $'6'$.
# generalizzando
Quando non e' soddisfatto il criterio di ottimalita ne di illimitatezza significa che esiste sicuramente una componente che possiamo "migliorare", questa componente introduce un vicolo sul $\delta$. 
Prendendo il $\delta$ massimo otteniamo il massimo miglioramento.
## esempio completo metodo simplesso
$$
\begin{align}
\text{min } 10x_{1}-x_{2}+x_{3}+7x_{4}  \\
x_{1}+x_{3}+2x_{4}=6 \\
x_{2}+x_{3}+7x_{4}=8 \\
x\geq 0
\end{align}
$$
Abbiamo
$$
A=\begin{pmatrix}
1 & 0 & 1 & 2 \\
0 & 1 & 1 & 7
\end{pmatrix}
$$
Prendiamo
$$
B=\{ 1,2 \};N=\{ 3,4 \}
$$
calcoliamo $\bar{x}$
$$
\bar{x}_{B}=A_{B}^{-1}b=\begin{pmatrix}
6 \\
8
\end{pmatrix}\implies \bar{x}=\begin{pmatrix}
6 \\
8 \\
0 \\
0
\end{pmatrix}(SBA)
$$
calcoliamo il vettore dei costi ridotti $\hat{c}_{N}^T=c_{N}^T-c_{B}^TA_{B}^{-1}A_{N}$
$$
\hat{c}_{N}^T=\begin{pmatrix}
1 & 7
\end{pmatrix}-\begin{pmatrix}
10 & -1
\end{pmatrix}\begin{pmatrix}
1 & 2 \\
1 & 7
\end{pmatrix}=\begin{pmatrix}
-8 & -6
\end{pmatrix}
$$
Avendo componenti negative il criterio di ottimalita' non e' soddisfatto
Prendiamo per esempio $j=4$
$$
y=-A_{B}^{-1}A_{4}=\begin{pmatrix}
-2 \\
-7
\end{pmatrix}
$$
Notiamo che anche il criterio di illimitatezza non e' soddisfatto.
Genero quindi una nuova SBA $\tilde{x}$.
$$
\delta^*=min\left\{  -\frac{\bar{x}_{1}}{y_{1}},-\frac{\bar{x}_{2}}{y_{2}}  \right\}=min\left\{  \frac{6}{2}, \frac{8}{7}  \right\}=\frac{8}{7}
$$
E' quindi il minimo $i^*=2$.
Entera in base la quarta ($j=4$)

$$
\tilde{x}=\begin{pmatrix}
6 \\
8 \\
0 \\
0
\end{pmatrix}+\frac{8}{7}\begin{pmatrix}
-2 \\
-7 \\
0 \\
1
\end{pmatrix}=\begin{pmatrix}
\frac{26}{7} \\
0 \\
0 \\
\frac{8}{7}
\end{pmatrix}
$$
Notiamo che e' uscita la seconda $(i^*=2)$ dalla base .
Abbiamo adesso quindi
$$
\tilde{B}=\{ 1,4 \};\tilde{N}=\{ 3,2 \}
$$
E abbiamo migliorato la nostra funzione obiettivo, quanto?
$$
f(\tilde{x})=f(\bar{x})+\hat{c}_{j}\delta=52-6\cdot \frac{8}{7}<52
$$
Adesso abbiamo migliorato la soluzione spostandoci su un altra SBA tramite l'operazione di pivot ma non e' detto che questa sia la soluzione ottimale, dovremmo iterare il criterio di ottimalita' per assicurarci questo.
## esercizio
Definire un esempio numerico con $n=5$ e $m=3$ in cui da una SBA non degenere si passa, con un'iterazione della fase 2, a una SBA degenere.
Ossia dobbiamo definire $B,N,A_{B}^{-1}b,A_{B}^{-1}A_{N},\hat{c}_{N}^T$.

> [!tip]
> Se $\bar{x}$ SBA non degenere
> -  $\delta^k> 0$ in questo caso la funzione obiettivo migliora
> 
> $\bar{x}$ SBA degenere 
> - $\delta^k=0$ in questo caso non migliora il valore della funzione obiettivo
> - $\delta^k > 0$ in questo caso la funzione obiettivo migliora
> 

